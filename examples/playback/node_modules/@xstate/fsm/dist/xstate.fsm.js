var t,e;t=this,e=function(t){"use strict";var e;(e=t.InterpreterStatus||(t.InterpreterStatus={}))[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped";const n={type:"xstate.init"};function o(t){return void 0===t?[]:[].concat(t)}function i(t,e){return"string"==typeof(t="string"==typeof t&&e&&e[t]?e[t]:t)?{type:t}:"function"==typeof t?{type:t.name,exec:t}:t}function r(t){return e=>t===e}function s(t){return"string"==typeof t?{type:t}:t}function a(t,e){return{value:t,context:e,actions:[],changed:!1,matches:r(t)}}function c(t,e,n){let o=e,i=!1;return[t.filter(t=>{if("xstate.assign"===t.type){i=!0;let e=Object.assign({},o);return"function"==typeof t.assignment?e=t.assignment(o,n):Object.keys(t.assignment).forEach(i=>{e[i]="function"==typeof t.assignment[i]?t.assignment[i](o,n):t.assignment[i]}),o=e,!1}return!0}),o,i]}const u=(t,e)=>t.actions.forEach(({exec:n})=>n&&n(t.context,e));t.assign=function(t){return{type:"xstate.assign",assignment:t}},t.createMachine=function(t,e={}){const[u,f]=c(o(t.states[t.initial].entry).map(t=>i(t,e.actions)),t.context,n),p={config:t,_options:e,initialState:{value:t.initial,actions:u,context:f,matches:r(t.initial)},transition:(e,n)=>{const{value:u,context:f}="string"==typeof e?{value:e,context:t.context}:e,g=s(n),l=t.states[u];if(l.on){const e=o(l.on[g.type]);for(const n of e){if(void 0===n)return a(u,f);const{target:e=u,actions:o=[],cond:s=(()=>!0)}="string"==typeof n?{target:n}:n;if(s(f,g)){const n=t.states[e],s=[].concat(l.exit,o,n.entry).filter(t=>t).map(t=>i(t,p._options.actions)),[a,d,y]=c(s,f,g);return{value:e,context:d,actions:a,changed:e!==u||a.length>0||y,matches:r(e)}}}}return a(u,f)}};return p},t.interpret=function(e){let o=e.initialState,i=t.InterpreterStatus.NotStarted;const a=new Set,c={_machine:e,send:n=>{i===t.InterpreterStatus.Running&&(o=e.transition(o,n),u(o,s(n)),a.forEach(t=>t(o)))},subscribe:t=>(a.add(t),t(o),{unsubscribe:()=>a.delete(t)}),start:s=>{if(s){const t="object"==typeof s?s:{context:e.config.context,value:s};o={value:t.value,actions:[],context:t.context,matches:r(t.value)}}return i=t.InterpreterStatus.Running,u(o,n),c},stop:()=>(i=t.InterpreterStatus.Stopped,a.clear(),c),get state(){return o},get status(){return i}};return c},Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).XStateFSM={});
